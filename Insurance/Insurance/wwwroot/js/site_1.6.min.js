function uploadImage(){$("#uploadImages").click()}function ShowAccountDetail(n,t){$("#CompanyName").attr("readonly",!0);$("#CompanyNameAbb").attr("readonly",!0);$("#RecipeCompany").attr("readonly",!0);$("#TaxNum").attr("readonly",!0);$("#RecipeBank").attr("readonly",!0);$("#RecipeAccount").attr("readonly",!0);$("#RecipeAddress").attr("readonly",!0);$("#RecipeType").attr("readonly",!0);$.ajax({async:!0,contentType:!1,dataType:"json",processData:!1,type:"get",url:"/Account/GetAccountDetail?userName="+n,success:function(n){if(n=="fail"){alert("当前账号权限不足");return}$("#Name").val(n.name);$("#Telephone").val(n.telephone);$("#Mail").val(n.mail);$("#CompanyName").val(n.companyName);$("#CompanyNameAbb").val(n.companyNameAbb);$("#RecipeCompany").val(n.recipeCompany);$("#TaxNum").val(n.taxNum);$("#RecipeBank").val(n.recipeBank);$("#RecipeAccount").val(n.recipeAccount);$("#RecipeAddress").val(n.recipeAddress);$("#RecipePhone").val(n.recipePhone);$("#recipettype").val(n.recipeType);t||($("#CompanyName").attr("readonly",!1),$("#CompanyNameAbb").attr("readonly",!1),$("#RecipeCompany").attr("readonly",!1),$("#TaxNum").attr("readonly",!1),$("#RecipeBank").attr("readonly",!1),$("#RecipeAccount").attr("readonly",!1),$("#RecipeAddress").attr("readonly",!1),$("#RecipeType").attr("readonly",!1))},fail:function(){alert("请求失败")},error:function(){alert("Unkonwn Error")}})}function GetAccountInfo(n,t){$("#baysbefore").attr("readonly",!0);$("#plan").attr("readonly",!0);$("#unitPrice").attr("readonly",!0);$("#allowCreateAccount").attr("readonly",!0);$.ajax({async:!0,contentType:!1,dataType:"json",processData:!1,type:"get",url:"/Account/GetAccountDetail?userName="+n,success:function(n){if(n=="fail"){alert("当前账号权限不足");return}$("#daysbefore").val(n.daysBefore);$("#plan").val(n._Plan);$("#unitPrice").val(n.unitPrice);n.allowCreateAccount!="1"?$("#allowCreateAccount").val("不允许"):$("#allowCreateAccount").val("允许");t||($("#baysbefore").attr("readonly",!1),$("#plan").attr("readonly",!1),$("#unitPrice").attr("readonly",!1),$("#allowCreateAccount").attr("readonly",!1))},fail:function(){alert("请求失败")},error:function(){alert("Unkonwn Error")}})}function UpdateAccountInfo(){$.ajax({type:"post",url:"/Account/UpdateAccountInfo",data:$("#form_updateAccountInfo").serialize(),dataType:"json",async:!0,success:function(n){n==!0?alert("保存成功"):alert("失败")},fail:function(){alert("失败")}});$("#modal_close").click()}function SubmitRecipet(n){n.disabled=!0;$.ajax({async:!0,data:$("#employeeChange").serialize(),datatype:"json",type:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:"/EmployeeChange/UpdateSummary",contentType:!1,processData:!1,success:function(t){if(t.length>=1)if(n.disabled=!1,t=="NotCalculated")alert("请先计算保费");else{var i=document.getElementById("tr_startdate"),r=document.getElementById("tr_enddate"),u=document.getElementById("description");u.innerText=t[0];i.innerText=t[1];r.innerText=t[2]}},fail:function(){n.disabled=!1;alert("失败")},error:function(){n.disabled=!1;alert("错误")}})}function SelectAll(n){var t=$('input[type="checkbox"]'),f=document.getElementById("totalCost"),u,r;for(f.inner="",i=0;i<t.length;i++)t[i]!=n&&(u=t[i].name,r=document.getElementById("cost"+u).innerText,n.checked?t[i].checked!=n.checked&&(t[i].checked=!0,GetSelectedCost(t[i],r)):t[i].checked!=n.checked&&(t[i].checked=!1,GetSelectedCost(t[i],r)))}function CalculateAll(){}function GetSelectedCost(n,t){var r=document.getElementById("totalCost"),i=parseFloat(r.innerText);n.checked?i+=parseFloat(t):i-=parseFloat(t);r.innerText=Math.round(i*100)/100}function MarkPaid(){var n=$('input[type="checkbox"]:checked'),r=[],u=0,t;for(i=0;i<n.length;i++)n[i].id!="cbx_selectAll"&&(r[u]=n[i].id,u++);t=new FormData;t.append("ids",r);$.ajax({async:!0,data:t,datatype:"json",type:"post",url:"/Home/MarkAsPaid",contentType:!1,processData:!1,success:function(n){n==!0&&(window.location.reload(),alert("操作成功"))}})}function SaveCost(n,t){if(!paidmoney_pattern.test(t.value)&&!paidmoney_pattern2.test(t.value)){alert("赔付金额不正确");t.value="";return}$.ajax({async:!0,processData:!1,type:"get",dataType:"json",url:"/Home/SaveCost?cost="+t.value+"&company="+n,success:function(n){(n=!0)&&alert("保存成功")},fail:function(){alert("保存失败")},error:function(){alert("错误")}})}function UpdatePersonalInfo(){$.ajax({type:"post",url:"/Account/UpdatePersonalInfo",data:$("#Form_UserInfo").serialize(),dataType:"json",async:!0,success:function(n){n==!0?alert("保存成功"):alert("失败")},fail:function(){alert("失败")}});$("#modal_close").click()}function SubmitAdd(n){var i,t,r;if(!(n.files.length>1)&&n.files.length!=0){for(CheckExcelType(n.files)||alert("文件格式不正确，请上传Excel文件"),i=new FormData,i.append("mode",n.id),t=0;t<n.files.length;t++)i.append("newExcel",n.files[0]);r=document.getElementById("invalidInfo");r.innerHTML="";$.ajax({type:"post",url:"/EmployeeChange/UpdateEmployees",data:i,async:!1,contentType:!1,dataType:!1,processData:!1,success:function(n){var l=document.getElementById("validTable"),a=document.getElementById("invalidTable"),e=0,v,s,i,h,c;for(t=0;t<n.length;t++)n[t].valid==!1&&e++;if(e>0){for(a.style.visibility="visible",l.style.visibility="collapse",v=0,t=0;t<n.length;t++)if(n[t].valid!=!0){i=document.createElement("tr");i.style.textAlign="center";var o=document.createElement("th"),y=document.createElement("td"),p=document.createElement("td"),w=document.createElement("td"),u=document.createElement("td");u.style.color="red";o.innerText=++v;o.scope="row";y.innerText=n[t].name;p.innerText=n[t].id;w.innerText=n[t].job;u.innerText=n[t].dataDesc;i.appendChild(o);i.appendChild(y);i.appendChild(p);i.appendChild(w);i.appendChild(u);r.appendChild(i)}}else{a.style.visibility="collapse";l.style.visibility="visible";s=document.getElementById("validInfo");s.innerHTML="";i=document.createElement("tr");i.style.textAlign="center";var u=document.createElement("td"),b=document.createElement("td"),f=document.createElement("td");f.id="price";h=document.createElement("td");h.id="tr_startdate";c=document.createElement("td");c.id="tr_enddate";u.innerText="数据无误";u.id="description";u.style.color="green";b.innerText=n.length-e;f.innerText="请计算保费";f.style.color="red";i.appendChild(u);i.appendChild(b);i.appendChild(f);i.appendChild(h);i.appendChild(c);s.appendChild(i)}},fail:function(n){alert(n)},error:function(){alert("错误")}})}}function Calculate(){var n=new FormData;if(document.getElementById("startdate").value==""){alert("请选择生效日期");return}n.append("startDate",document.getElementById("startdate").value);$.ajax({type:"post",url:"/EmployeeChange/CalculatePrice",async:!0,data:n,contentType:!1,dataType:!1,processData:!1,success:function(n){n==-9999999?alert("生效日期不正确"):n==-9999998?alert("上传的文件中存在信息格式错误，修改后重试"):n==-9999997?alert("所选月份的表单不存在"):n==-9999995?alert("生效日期不正确，该月保单可能已被锁定"):document.getElementById("price").innerText=n},fail:function(){alert("fail")},error:function(){alert("error")}})}function AutoRenew(n){n.disabled=!0;n.innerText="请等待...";var t=$(n).attr("data-company"),i=$(n).attr("data-enddate"),r=$(n).attr("data-currentmonth");$.ajax({async:!0,data:{CompanyName:t,NextMonthEndDay:i,CurrentMonth:r},type:"post",url:"/Home/StartRenew",success:function(n){alert(n);window.location.reload()}})}function showPersonalInfo(n,t){$.ajax({type:"get",async:!0,url:"/Home/ShowPersonalDetail?comp="+n+"&id="+t,contentType:!1,dataType:!1,processData:!1,success:function(n){var r=document.getElementById("info");for(r.innerHTML="",i=0;i<n.length;i++){var t=document.createElement("tr"),u=document.createElement("td"),f=document.createElement("td"),e=document.createElement("td"),o=document.createElement("td");u.innerText=n[i].mode=="Add"?"加保":"减保";f.innerText=n[i].uploadDate;e.innerText=n[i].start;o.innerText=n[i].end;t.appendChild(u);t.appendChild(f);t.appendChild(e);t.appendChild(o);r.appendChild(t)}},fail:function(){alert("fail")},error:function(){alert("error")}})}function EncodeIEUrl(n){var i=new RegExp("[\\u4E00-\\u9FFF]+","g"),t;i.test(n.href)&&(t=window.encodeURI(n.href),n.href=t)}function showMsg(){var n=document.getElementById("msg");n.innerHTML!=""&&alert(n.innerHTML)}function readFile(){var t,n,i;if(prevFile.length>9){alert("图片数量上限为9个，请删除部分已选图片后重试");return}if(t=document.getElementById("imgArea"),t.style.height=window.screen.height*.7+"px",t.style.visibility="visible",n=document.getElementById("uploadImages"),n.files.length+prevFile.length>9){alert("图片数量上限为9个，请删除部分已选图片后重试");return}if(i=$("#imgArea").width(),!CheckImageType(n.files)){alert("文件格式不支持，请上传图片文件");return}filesCount=n.files.length;btnSubmit.disabled="disabled";btnSubmit.style.backgroundColor="grey";setTimeout(function(){for(var i,r=0;r<n.files.length;r++)i=n.files[r],isGifImg(i)?(prevFile.push(i),CreateThumbnail(t,i)):i.size>1048576?CompressImages(i):(prevFile.push(i),CreateThumbnail(t,i));n.value=""},200)}function ShowLargeImage(n){var f=n.parentNode.id,r=document.getElementById("imgCircle"),t,u;for(r.style.height=screenHeight*.82+"px",r.style.width=$(r).height()*1.5+"px",t=r.getElementsByTagName("ul")[0],u=document.getElementById("viewCarousel"),i=0;i<t.children.length;i++)if(t.children[i].classList.contains("active")){t.children[i].classList.remove("active");u.getElementsByClassName("imgBox")[i].parentNode.classList.remove("active");break}t.children[f].classList.add("active");u.getElementsByClassName("imgBox")[f].parentNode.classList.add("active");document.getElementById("imgCircle").style.visibility="visible";EV_modeAlert("imgCircle")}function ChangeHeight(n){n.style.height=$(n).width()+"px"}function ReadyToPushFile(n){n!=null&&n!=undefined&&prevFile.push(n)}function dataURLtoFile(n,t){for(var r=n.split(","),e=r[0].match(/:(.*?);/)[1],u=atob(r[1]),i=u.length,f=new Uint8Array(i);i--;)f[i]=u.charCodeAt(i);return new File([f],t,{type:e})}function getStyle(n,t){return window.getComputedStyle?window.getComputedStyle(n,null)[t]:n.currentStyle[t]}function CompressImages(n){if(!(n.size<=1048576)){var i=n.size/1048576,t=document.createElement("img"),r=window.URL||window.webkitURL||window.imgURL,u=r.createObjectURL(n),f=document.getElementById("imgArea");t.src=u;t.style.display="none";t.onload=function(){CompressImgToFile(t,i,compressedFile,CreateThumbnail)};f.appendChild(t)}}function CompressImgToFile(n,t,i,r){var u=document.createElement("canvas"),c=u.getContext("2d"),l=$(n).width(),a=$(n).height(),f,e,o,s,h;f=t>2?t/1.5:1.3;u.width=l/f;u.height=a/f;e=u.width;o=u.height;c.drawImage(n,0,0,e,o);n.outerHTML="";s=u.toDataURL("image/jpeg",1);u=null;i=dataURLtoFile(s,file.name);i.size<=1048576?(prevFile.push(i),h=document.getElementById("imgArea"),r(h,i)):CompressImages(i)}function CheckImageType(n){for(var u,r=!0,t="",i=0;i<n.length;i++)if(file=n[i],u=file.name.lastIndexOf("."),t=file.name.substring(u).toLowerCase(),t!=".bmp"&&t!=".png"&&t!=".gif"&&t!=".jpg"&&t!=".jpeg"&&t!=".ico"){r=!1;break}return r}function CheckExcelType(n){for(var u,r=!0,t="",i=0;i<n.length;i++)if(file=n[i],u=file.name.lastIndexOf("."),t=file.name.substring(u).toLowerCase(),t!=".xls"&&t!=".xlsx"&&t!=".xlsm"){r=!1;break}return r}function isGifImg(n){var t=!1,i="",r=n.name.lastIndexOf(".");return i=n.name.substring(r).toLowerCase(),i==".gif"&&(t=!0),t}function InitializeSize(){document.getElementById("submitArea").style.width=$("main").width()*.99+"px";document.getElementsByName("storyContent")[0].innerHTML=document.getElementsByClassName("invisbleComment")[0].innerHTML}function UpdateLiIndex(n){for(var i=document.getElementById("imgList"),t=Number(n);t<i.children.length;t++)i.children[t].id>n&&(i.children[t].id-=1)}function DetailImage(n){var i=n.src,t;n.outerHTML="";t=document.getElementById("imgArea");t.style.height=window.screen.height*.7+"px";t.style.visibility="visible";CreateThumbnail(t,n)}function SetMargin(n){initialized||(initialized=!0);var t=n.parentNode.parentNode;n.width<n.height?screenHeight>screenWidth?(n.style.height=screenHeight*.95+"px",n.style.width="auto",n.style.marginTop="5px"):(n.style.height=screenHeight*.82*.95+"px",n.style.width="auto",n.style.marginTop="5px"):screenHeight>screenWidth?(n.style.width=screenWidth*.95+"px",n.style.height="auto",n.style.marginTop="5px"):(n.style.width=screenHeight*1.23*.95+"px",n.style.height="auto",n.style.marginTop=screenHeight*.82/2-n.height/2)}function ShowCarousel(){if(!CarouselImagesCreated){var n=document.createElement("imgCircle");n.style.height=screenHeight*.75+"px"}}function CreateCarouselImage(){var r=document.getElementById("viewCarousel"),t,u,n,f;for(i=0;i<r.getElementsByTagName("div").length;i++)t=r.getElementsByTagName("div")[i],u=t.innerText.trim(),t.innerText="",screenHeight>screenWidth?(t.style.width="95%",t.style.height=$(t).width()*.5+"px"):(t.style.width="50%",t.style.height=$(t).width()*.7+"px"),n=document.createElement("img"),f=u,n.src=f,n.align="center",n.onload=function(){var i,r,u,f;$(n).width()<$(t).width()||$(n).height()<$(t).height()?(n.style.width=$(n).width()+"px",n.style.height=$(n).height()+"px"):(i=$(n).height(),r=$(n).width(),n.style.height="95%",u=$(n).height(),n.style.width=r*u/i+"px");f=Math.abs($(t).height()-$(n).height());n.style.marginTop=f/2+"px";n.style.visibility="visible"},t.appendChild(n),CarouselImagesCreated=!0}function HomepageIntialize(){var n=document.getElementsByClassName("carousel-item"),t=document.getElementsByClassName("homePageImg"),f=document.getElementById("imgCircle"),o=document.getElementById("searchGroup"),s=document.getElementsByClassName("searchElements")[0],r,e,u;if(f.style.margin="auto",e=.3,screenHeight<screenWidth)for(i=0;i<n.length;i++)s.style.width="80%",u=!1,n[i].classList.contains("active")||(n[i].classList.add("active"),i!=0&&(u=!0)),n[i].style.height=e*screenHeight+"px",sc_height=$(n[i]).height()/$(t[i]).height(),sc_width=$(n[i]).width()/$(t[i]).width(),r=sc_height>sc_width?sc_width:sc_height,r<1&&(t[i].style.width=r*$(t[i]).width()+"px"),t[i].style.visibility="visible",u&&n[i].classList.remove("active");else for(o.style.width="95%",i=0;i<n.length;i++)u=!1,n[i].classList.contains("active")||(n[i].classList.add("active"),i!=0&&(u=!0)),$(n[i]).width("90%"),$(n[i]).height($(n[i]).width()*.7),n[i].style.margin="auto",sc_height=$(n[i]).height()/$(t[i]).height(),sc_width=$(n[i]).width()/$(t[i]).width(),r=sc_height>sc_width?sc_width:sc_height,r<1&&(t[i].style.width=$(t[i]).width()*r+"px"),t[i].style.marginTop=($(n[i]).height()-$(t[i]).height())/2+"px",t[i].style.visibility="visible",u&&n[i].classList.remove("active");f.style.visibility="visible"}function CreateThumbnail(n,t){var f=window.URL||window.webkitURL||window.imgURL,r=document.createElement("li"),i,u;screenHeight>screenWidth?(r.style.width="45%",r.style.height=$("#imgArea").height()*.32+"px"):(r.style.width="32%",r.style.height=$("#imgArea").height()*.32+"px");r.style.cssFloat="left";r.style.margin="0.2% 0.667%";r.style.borderWidth="3px";r.style.borderStyle="solid";r.style.textAlign="center";r.style.borderColor="grey";r.style.position="relative";i=document.createElement("img");t.src&&t.src.substr(0,4)=="http"?i.src=t.src:(u=f.createObjectURL(t),i.src=u);i.style.visibility="hidden";i.align="center";i.style.cursor="pointer";i.onclick=function(){ShowLargeImage(i)};i.onload=function(){var f,n,t,e,u,c;if($(i).width()<$(r).width()||$(i).height()<$(r).height())$(i).width()>=$(r).width()&&$(i).height()<$(r).height()?(n=$(i).width(),t=$(i).height(),i.style.width="95%",f=$(i).width(),u=f/n,i.style.height=u*t+"px"):$(i).width()<$(r).width()&&$(i).height()>=$(r).height()&&(n=$(i).width(),t=$(i).height(),i.style.height="95%",e=$(i).height(),u=e/t,i.style.width=u*n+"px");else{var o=$(i).height(),l=$(i).width(),s=$(r).width()/l,h=$(r).height()/o,a=s>h?h:s;i.style.height=.95*a*o+"px";i.style.width="auto"}c=Math.abs($(r).height()-$(i).height());i.style.marginTop=c/2+"px";i.style.visibility="visible"};typeof filesCount!="undefined"&&(r.onmouseenter=function(){CreateDeleteBtn(r)},r.onmouseleave=function(){RemoveDeleteBtn(r)});r.appendChild(i);r.id=currentLiIndex;n.getElementsByTagName("ul")[0].appendChild(r);currentLiIndex+=1;filesCompressed+=1;typeof filesCount!="undefined"&&filesCompressed==filesCount&&(btnSubmit.disabled="",btnSubmit.style.backgroundColor="orange",filesCompressed=0)}function showLargeImg(){}function CreateDeleteBtn(n){var t=document.createElement("div");t.style.width=$(n).width()+"px";t.style.height=.1*$(n).height()+"px";t.style.backgroundColor="red";t.style.textAlign="center";t.innerText="删除";t.style.margin="0";t.style.position="absolute";t.style.top="5px";t.onclick=function(){DeleteThumbnail(n)};n.appendChild(t)}function DeleteThumbnail(n){n.outerHTML="";UpdateLiIndex(n.id);prevFile.splice(n.id,1);currentLiIndex-=1}function RemoveDeleteBtn(n){var t=n.getElementsByTagName("div")[0];t.outerHTML=""}function toUtf8(n){var i,r,u,t;for(i="",u=n.length,r=0;r<u;r++)t=n.charCodeAt(r),t>=1&&t<=127?i+=n.charAt(r):t>2047?(i+=String.fromCharCode(224|t>>12&15),i+=String.fromCharCode(128|t>>6&63),i+=String.fromCharCode(128|t>>0&63)):(i+=String.fromCharCode(192|t>>6&31),i+=String.fromCharCode(128|t>>0&63));return i}function ValidateAndUpload(){cansubmit=!1;imgs_failed_upload=0;var n=!0,i=!0,t=document.getElementById("GameName").value;t=toUtf8(t);var r=$("#IdRole").val(),u=$("#StoryTitle").val(),f=$("#ServerName").val(),e=divComment.innerText,o=document.getElementsByName("storyDate")[0].value,s={IdRole:r,ServerName:f,StoryContent:e,GameName:t,StoryTitle:u,StoryTime:o},h=JSON.stringify(s);$.ajax({type:"post",url:"/Submit/ValidateModel",data:h,dataType:"json",async:!0,contentType:"application/json",success:function(r){var f,u;if(r==!0){for(f=new FormData,u=0;u<prevFile.length;u++)f.append("imageFiles"+u,prevFile[u]);$.ajax({type:"Post",url:"/Submit/ValidateImagesFromJS",cache:!1,async:!0,data:f,contentType:!1,processData:!1,beforeSend:function(n){n.setRequestHeader("Game",t)},success:function(t){if(t!=""&&t!="-1")for(document.getElementById("guid").value=t,t=folder+t,u=0;u<prevFile.length;u++){var i=prevFile[u];uploadFile(i,t,function(t){t&&(n=!1,u=prevFile.length)})}},fail:function(){alert("图片格式有误,请检查后再试");EV_closeAlert("waiting");n=!1},error:function(){alert("图片格式有误,请检查后再试");EV_closeAlert("waiting");n=!1}})}else i=!1,n=!1},fail:function(){n=!1;i=!1;model_invalid()},error:function(){n=!1;i=!1;model_invalid()}})}function model_invalid(){alert("格式有误,请检查后再试");EV_closeAlert("waiting")}function ShowProgressBar(){var n=document.getElementById("waiting");n.style.visibility="visible";EV_modeAlert("waiting")}function UpdateComment(){divComment=document.getElementsByClassName("comment")[0];inputComment=document.getElementsByClassName("invisbleComment")[0];inputComment.value=divComment.innerHTML;setTimeout(ValidateAndUpload,100);ShowProgressBar()}function wol(){var u=document.getElementsByName("storyDate")[0],i=new Date,t=i.getMonth(),n,r;t.toString().length==1&&(t="0"+t);n=i.getDate();n.toString().length==1&&(n="0"+n);r=i.getFullYear()+"/"+t+"/"+n;u.value=r}function isValidSubmit(){return canRegister?!0:!1}function isValidReset(){return canReset}function Encrypt(){var n=document.getElementById("pwdBox"),t=document.getElementById("confirmPwd"),r;if(k=getCookie("invalidFlag"),n==""||t==""){canRegister=!1;canReset=!1;return}for(r=getCookie("Frontend"),i=1;i<=500;i++);canRegister=!0;canReset=!0}function InitializeCOS(){cos=new COS({getAuthorization:getAuthorization({Method:"PUT",Pathname:"/"+Key},Test)})}function UpdateValidationImg(n){var t=new XMLHttpRequest;t.open("Get",n,!1);t.onreadystatechange=function(){t.readyState==4&&t.status==200&&(document.getElementById("validationImg").src=t.responseText)};t.send()}function async_ValidateMail(n){var t=new XMLHttpRequest,i=document.getElementById("img_loading_mail"),r=document.getElementById("MailAddress").value;if(r==""){n();document.getElementById("mailMsg").style.visibility="hidden";return}t.open("GET","MailExists?input="+r,!0);t.onreadystatechange=function(){if(t.readyState==4&&t.status==200){var r=t.responseText;r=="true"?(mailPass=!1,i.style.visibility="hidden",document.getElementById("mailMsg").style.color="red",document.getElementById("mailMsg").innerText="该邮箱已被注册",document.getElementById("mailMsg").style.visibility="visible",n()):r=="false"&&(mailPass=!0,i.style.visibility="hidden",document.getElementById("mailMsg").innerText="√ 该邮箱可用",document.getElementById("mailMsg").style.visibility="visible",document.getElementById("mailMsg").style.color="green",n())}};i.style.visibility="visible";t.send()}function rstpwd_validateFields(){var n=document.getElementById("id"),t=document.getElementById("mail"),i=!0;(n.value==""||t.value=="")&&(i=!1)}function async_ValidateResetPwd(){var n=new XMLHttpRequest,t=document.getElementById("validationResult").value;if(t==""){document.getElementById("validationMsg").style.visibility="hidden";return}if(parseInt(t).toString()=="NaN"){document.getElementById("validationMsg").innerText="请输入数字";document.getElementById("validationMsg").style.color="red";document.getElementById("validationMsg").style.visibility="visible";return}n.open("GET","/Users/ValidationResult?input="+t,!0);n.onreadystatechange=function(){if(n.readyState==4&&n.status==200){var t=n.responseText;t=="false"?(validationPass=!1,document.getElementById("validationResult").value="",document.getElementById("validationMsg").style.color="red",document.getElementById("validationMsg").innerText="× ",document.getElementById("validationMsg").style.visibility="visible",UpdateValidationImg("Users/UpdateValidationImg")):t=="true"&&(validationPass=!0,document.getElementById("validationMsg").innerText="√ ",document.getElementById("validationMsg").style.visibility="visible",document.getElementById("validationMsg").style.color="green")}};n.send()}function async_Validate(n){var i=document.getElementById("img_loading_validationcode"),t=new XMLHttpRequest,r=document.getElementById("validationResult").value;if(r==""){n();document.getElementById("validationMsg").style.visibility="hidden";return}if(parseInt(r).toString()=="NaN"){document.getElementById("validationMsg").innerText="请输入数字";document.getElementById("validationMsg").style.color="red";document.getElementById("validationMsg").style.visibility="visible";return}t.open("GET","/Login/ValidationResult?input="+r,!0);t.onreadystatechange=function(){if(t.readyState==4&&t.status==200){var r=t.responseText;r=="false"?(validationPass=!1,i.style.visibility="hidden",document.getElementById("validationResult").value="",document.getElementById("validationMsg").style.color="red",document.getElementById("validationMsg").innerText="×",document.getElementById("validationMsg").style.visibility="visible",n(),UpdateValidationImg("/Login/UpdateValidationImg")):r=="true"&&(validationPass=!0,i.style.visibility="hidden",document.getElementById("validationMsg").innerText="√",document.getElementById("validationMsg").style.visibility="visible",document.getElementById("validationMsg").style.color="green",n())}};i.style.visibility="visible";t.send()}function ValidateFields_RegisterView(){var n=!0,r=document.getElementById("pwdBox"),i=document.getElementById("UserName"),u=document.getElementById("confirmPwd"),t;i.value!=""&&userNamePass!=!1&&id_pattern.test(i.value)||(n=!1);(r.value==""||pwdPass==!1)&&(n=!1);(u.value==""||pwdPass==!1)&&(n=!1);t=document.getElementById("validationResult");t.value!=""&&validationPass!=!1&&valiCode_pattern.test(t.value)||(n=!1);n?(document.getElementById("btnRegister").disabled="",canRegister=!0):(document.getElementById("btnRegister").disabled="disabled",canRegister=!1)}function UserNameExists(n){var r,i,t;if(ValidateFields_RegisterView(),r=document.getElementById("UserName"),r.value==""){document.getElementById("userExists").innerText="";return}if(!id_pattern.test(r.value)){document.getElementById("userExists").innerText="X 用户名必须以汉字或字母开头，可包含汉字、字母、数字及下划线，最短为2个字符，最长为18个字符";document.getElementById("userExists").style.color="red";return}i=document.getElementById("img_loading_username");t=new XMLHttpRequest;t.open("Get","UserNameExists?userName="+n,!0);t.onreadystatechange=function(){t.readyState==4&&t.status==200&&(t.responseText=="true"?(userNamePass=!1,i.style.visibility="hidden",document.getElementById("userExists").innerText="X 用户名已存在",document.getElementById("userExists").style.color="red",ValidateFields_RegisterView()):(userNamePass=!0,i.style.visibility="hidden",document.getElementById("userExists").innerText="√ 用户名可用",document.getElementById("userExists").style.color="green",ValidateFields_RegisterView()))};i.style.visibility="visible";t.send()}function PwdValid(){var n=document.getElementById("pwdBox"),t=document.getElementById("confirmPwd");n.value==""||t.value==""||n.value!=t.value?(pwdPass=!1,n.value!=t.value&&n.value!=""&&t.value!=""&&(document.getElementById("cPwdMsg").innerText="两次输入的密码不一致",document.getElementById("cPwdMsg").style.visibility="visible")):pwd_pattern.test(n.value)?(document.getElementById("cPwdMsg").innerText="√ 密码可用",document.getElementById("cPwdMsg").style.color="green",pwdPass=!0):(pwdPass=!1,document.getElementById("cPwdMsg").innerText="密码必须包含字母及数字，可包含字母、数字及下划线，长度为7-20位。",document.getElementById("cPwdMsg").style.visibility="visible");ValidateFields_RegisterView()}function ValidateFields_ResetPwdView(){var n=document.getElementById("pwdBox"),t=document.getElementById("confirmPwd"),r=document.getElementById("UserName"),u=document.getElementById("validationResult"),i=document.getElementById("pwdErr");n.value!=""&&r.value!=""&&u.value!=""&&t.value!=""&&n.value==t.value&&pwd_pattern.test(n.value)?(document.getElementById("btnSubmit").disabled="",i.innerText="",canRegister=!0):(n.value!=t.value?i.innerText="两次输入的密码不一致":pwd_pattern.test(n.value)||(i.innerText="密码必须包含字母及数字，可包含字母、数字及下划线，长度为7-20位。"),document.getElementById("btnSubmit").disabled="disabled",canRegister=!1)}function ValidateFields_LoginView(){var n=document.getElementById("pwdBox"),t=document.getElementById("UserName"),i=document.getElementById("validationResult");document.getElementById("btnSubmit").disabled=n.value!=""&&t.value!=""&&i.value!=""?"":"disabled"}function LoginValidate(){var n=document.getElementById("pwdBox"),t=getCookie("Frontend")}function ResetPwd(){var i=document.getElementById("pwdBox"),n,t;i.value="";n=document.getElementById("confirmPwd");n!=null&&(n.value="");t=document.getElementById("UserName");t&&(t.value="")}function InitializeRegisterPage(){SetFieldsEvent()}function ShowPwsTips(){var n=document.getElementById("cPwdMsg");n.innerText="密码须包含字母及数字，可由字母、数字及下划线构成，长度为7-20位。"}function SetFieldsEvent(){var n=document.getElementById("pwdBox"),t=document.getElementById("UserName"),i=document.getElementById("confirmPwd");i.onfocus=function(){ShowPwsTips()};n.onfocus=function(){ShowPwsTips()};t.onblur=function(){UserNameExists(t.value)};n.onblur=function(){PwdValid()};i.onblur=function(){PwdValid()}}function IsAgreementChecked(){var n=document.getElementById("isAgree");isAgreePass=n.checked==!0?!0:!1;ValidateFields_RegisterView()}function MailValdiation(n){var t=document.getElementById("mailMsg");if(n.value==""){t.innerText="";return}if(mail_pattern.test(n.value))t.innerText="";else{t.innerText="邮箱格式不正确";t.style.color="red";ValidateFields_RegisterView();return}async_ValidateMail(ValidateFields_RegisterView)}function getCookie(n){return document.cookie.length>0&&(c_start=document.cookie.indexOf(n+"="),c_start!=-1)?(c_start=c_start+n.length+1,c_end=document.cookie.indexOf(";",c_start),c_end==-1&&(c_end=document.cookie.length),unescape(document.cookie.substring(c_start,c_end))):""}function md(n){var e=Array(),f,it,rt,ut,ft,t,i,r,u,o=7,s=12,h=17,c=22,l=5,a=9,v=14,y=20,p=4,w=11,b=16,k=23,d=6,g=10,nt=15,tt=21,et;for(n=uTF8Encode(n),e=convertToWordArray(n),t=1732584193,i=4023233417,r=2562383102,u=271733878,f=0;f<e.length;f+=16)it=t,rt=i,ut=r,ft=u,t=FF(t,i,r,u,e[f+0],o,3614090360),u=FF(u,t,i,r,e[f+1],s,3905402710),r=FF(r,u,t,i,e[f+2],h,606105819),i=FF(i,r,u,t,e[f+3],c,3250441966),t=FF(t,i,r,u,e[f+4],o,4118548399),u=FF(u,t,i,r,e[f+5],s,1200080426),r=FF(r,u,t,i,e[f+6],h,2821735955),i=FF(i,r,u,t,e[f+7],c,4249261313),t=FF(t,i,r,u,e[f+8],o,1770035416),u=FF(u,t,i,r,e[f+9],s,2336552879),r=FF(r,u,t,i,e[f+10],h,4294925233),i=FF(i,r,u,t,e[f+11],c,2304563134),t=FF(t,i,r,u,e[f+12],o,1804603682),u=FF(u,t,i,r,e[f+13],s,4254626195),r=FF(r,u,t,i,e[f+14],h,2792965006),i=FF(i,r,u,t,e[f+15],c,1236535329),t=GG(t,i,r,u,e[f+1],l,4129170786),u=GG(u,t,i,r,e[f+6],a,3225465664),r=GG(r,u,t,i,e[f+11],v,643717713),i=GG(i,r,u,t,e[f+0],y,3921069994),t=GG(t,i,r,u,e[f+5],l,3593408605),u=GG(u,t,i,r,e[f+10],a,38016083),r=GG(r,u,t,i,e[f+15],v,3634488961),i=GG(i,r,u,t,e[f+4],y,3889429448),t=GG(t,i,r,u,e[f+9],l,568446438),u=GG(u,t,i,r,e[f+14],a,3275163606),r=GG(r,u,t,i,e[f+3],v,4107603335),i=GG(i,r,u,t,e[f+8],y,1163531501),t=GG(t,i,r,u,e[f+13],l,2850285829),u=GG(u,t,i,r,e[f+2],a,4243563512),r=GG(r,u,t,i,e[f+7],v,1735328473),i=GG(i,r,u,t,e[f+12],y,2368359562),t=HH(t,i,r,u,e[f+5],p,4294588738),u=HH(u,t,i,r,e[f+8],w,2272392833),r=HH(r,u,t,i,e[f+11],b,1839030562),i=HH(i,r,u,t,e[f+14],k,4259657740),t=HH(t,i,r,u,e[f+1],p,2763975236),u=HH(u,t,i,r,e[f+4],w,1272893353),r=HH(r,u,t,i,e[f+7],b,4139469664),i=HH(i,r,u,t,e[f+10],k,3200236656),t=HH(t,i,r,u,e[f+13],p,681279174),u=HH(u,t,i,r,e[f+0],w,3936430074),r=HH(r,u,t,i,e[f+3],b,3572445317),i=HH(i,r,u,t,e[f+6],k,76029189),t=HH(t,i,r,u,e[f+9],p,3654602809),u=HH(u,t,i,r,e[f+12],w,3873151461),r=HH(r,u,t,i,e[f+15],b,530742520),i=HH(i,r,u,t,e[f+2],k,3299628645),t=II(t,i,r,u,e[f+0],d,4096336452),u=II(u,t,i,r,e[f+7],g,1126891415),r=II(r,u,t,i,e[f+14],nt,2878612391),i=II(i,r,u,t,e[f+5],tt,4237533241),t=II(t,i,r,u,e[f+12],d,1700485571),u=II(u,t,i,r,e[f+3],g,2399980690),r=II(r,u,t,i,e[f+10],nt,4293915773),i=II(i,r,u,t,e[f+1],tt,2240044497),t=II(t,i,r,u,e[f+8],d,1873313359),u=II(u,t,i,r,e[f+15],g,4264355552),r=II(r,u,t,i,e[f+6],nt,2734768916),i=II(i,r,u,t,e[f+13],tt,1309151649),t=II(t,i,r,u,e[f+4],d,4149444226),u=II(u,t,i,r,e[f+11],g,3174756917),r=II(r,u,t,i,e[f+2],nt,718787259),i=II(i,r,u,t,e[f+9],tt,3951481745),t=addUnsigned(t,it),i=addUnsigned(i,rt),r=addUnsigned(r,ut),u=addUnsigned(u,ft);return et=wordToHex(t)+wordToHex(i)+wordToHex(r)+wordToHex(u),et.toUpperCase()}function EV_modeAlert(n){var t=document.createElement("div");t.setAttribute("id","EV_bgModeAlertDiv");document.body.appendChild(t);EV_Show_bgDiv();EV_MsgBox_ID=n;EV_Show_msgDiv()}function EV_closeAlert(){var n=document.getElementById(EV_MsgBox_ID),t=document.getElementById("EV_bgModeAlertDiv");n.style.display="none";document.body.removeChild(t);EV_MsgBox_ID=""}function resetCarouselMargin(){var n=document.getElementById(EV_MsgBox_ID),t=$(n).height();zoomRatio=t/originalHeight;n.style.marginTop=0*zoomRatio+"px"}function getOriginalCarouselMarginTop(n,t){originTop=n;originalHeight=t;originalParametersInitialized=!0}function EV_Show_msgDiv(){var n=document.getElementById(EV_MsgBox_ID),t=document.getElementById("viewCarousel");n.style.visibility="visible";n.style.display="block";screenHeight>screenWidth&&(t&&(t.style.height=screenHeight+"px"),n.style.width=screenWidth+"px",n.style.height=screenHeight+"px");var r=n.scrollWidth,u=n.scrollHeight,i=EV_myScrollTop(),f=EV_myScrollLeft(),e=EV_myClientWidth(),o=EV_myClientHeight(),s=i+Math.round((o-u)/2),h=f+Math.round((e-r)/2);n.style.position="absolute";n.style.top=i+10+"px";n.style.left=h+"px";n.style.zIndex="10001";originalParametersInitialized?resetCarouselMargin():getOriginalCarouselMarginTop(s,$(n).height())}function EV_Show_bgDiv(){var n=document.getElementById("EV_bgModeAlertDiv"),t=EV_myClientWidth(),i=EV_myClientHeight(),r=EV_myScrollTop(),u=EV_myScrollLeft();n.style.position="absolute";n.style.top=r+"px";n.style.left=u+"px";n.style.width=t+"px";n.style.height=i+"px";n.style.zIndex="10000";n.style.background="#fff";n.style.filter="progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=60,finishOpacity=60);";n.style.opacity="0.8"}function EV_myScrollTop(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}function EV_myScrollLeft(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0}function EV_myClientWidth(){return document.documentElement.clientWidth||document.body.clientWidth||0}function EV_myClientHeight(){return document.documentElement.clientHeight||document.body.clientHeight||0}function switch_tab(n){var r=document.getElementById("tabList"),t=r.getElementsByTagName("li");for(i=0;i<t.length;i++)t[i].classList.remove("li_tab_active");n.classList.add("li_tab_active")}function load_latest(n){switch_tab(n);tbl_body_hot.style.visibility="collapse";tbl_body_latest.style.visibility="visible"}function load_hotest(n){switch_tab(n);tbl_body_hot.style.visibility="visible";tbl_body_latest.style.visibility="collapse"}function load_random(n){switch_tab(n)}var prevFile=[],screenWidth=window.screen.width,screenHeight=window.screen.height,imgLoadedFlag=!1,base64String="",compressed=!1,btnSubmit=document.getElementById("btnSubmit"),filesCompressed=0,currentLiIndex=0,compressedFile,imgRatio=.6,initialized=!1,CarouselImagesCreated=!1,cansubmit,imgs_failed_upload=0,divComment,inputComment,k,Bucket="vgamestory-1300222705",Region="ap-shanghai",protocol=location.protocol==="https:"?"https:":"http:",prefix=protocol+"//"+Bucket+".cos."+Region+".myqcloud.com/",cos,credentials,getAuthorization=function(n,t){var i=new XMLHttpRequest;i.open("GET","/TencentCOS/GetWriteOnlyCredential",!1);i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){var r;r=eval("("+i.response+")");r=r.value;r?t(null,{XCosSecurityToken:r.Credentials.Token,Authorization:CosAuth({SecretId:r.Credentials.TmpSecretId,SecretKey:r.Credentials.TmpSecretKey,Method:n.Method,Pathname:n.Pathname,ExpiredTime:r.ExpiredTime})}):t("获取签名出错1")}};i.onerror=function(){t("获取签名出错2")};i.send()},validationPass=!1,userNamePass=!1,pwdPass=!1,canRegister=!1,canReset=!1,mailPass=!1,isAgreePass=!1,id_pattern=/^[a-zA-Z\u4E00-\u9FA5]{1}[a-zA-Z0-9_\u4E00-\u9FA5]{1,17}$/,mail_pattern=/[\w!#$%&'*+/=?^_`{|}~-]+(?:\.[\w!#$%&'*+/=?^_`{|}~-]+)*@(?:[\w](?:[\w-]*[\w])?\.)+[\w](?:[\w-]*[\w])?/,pwd_pattern=/^(?=.*\d)(?=.*[a-zA-Z])[0-9a-zA-Z_]{6,20}$/,valiCode_pattern=/^-?[1-9]\d*$/,paidmoney_pattern=/^\d+(\.\d+)?$/,paidmoney_pattern2=/^\d+$/,fieldsList_register=[],rotateLeft=function(n,t){return n<<t|n>>>32-t},addUnsigned=function(n,t){var f,e,r,u,i;return(r=n&2147483648,u=t&2147483648,f=n&1073741824,e=t&1073741824,i=(n&1073741823)+(t&1073741823),f&e)?i^2147483648^r^u:f|e?i&1073741824?i^3221225472^r^u:i^1073741824^r^u:i^r^u},F=function(n,t,i){return n&t|~n&i},G=function(n,t,i){return n&i|t&~i},H=function(n,t,i){return n^t^i},I=function(n,t,i){return t^(n|~i)},FF=function(n,t,i,r,u,f,e){return n=addUnsigned(n,addUnsigned(addUnsigned(F(t,i,r),u),e)),addUnsigned(rotateLeft(n,f),t)},GG=function(n,t,i,r,u,f,e){return n=addUnsigned(n,addUnsigned(addUnsigned(G(t,i,r),u),e)),addUnsigned(rotateLeft(n,f),t)},HH=function(n,t,i,r,u,f,e){return n=addUnsigned(n,addUnsigned(addUnsigned(H(t,i,r),u),e)),addUnsigned(rotateLeft(n,f),t)},II=function(n,t,i,r,u,f,e){return n=addUnsigned(n,addUnsigned(addUnsigned(I(t,i,r),u),e)),addUnsigned(rotateLeft(n,f),t)},convertToWordArray=function(n){for(var r,u=n.length,o=u+8,s=(o-o%64)/64,e=(s+1)*16,i=Array(e-1),f=0,t=0;t<u;)r=(t-t%4)/4,f=t%4*8,i[r]=i[r]|n.charCodeAt(t)<<f,t++;return r=(t-t%4)/4,f=t%4*8,i[r]=i[r]|128<<f,i[e-2]=u<<3,i[e-1]=u>>>29,i},wordToHex=function(n){for(var i="",r="",u,t=0;t<=3;t++)u=n>>>t*8&255,r="0"+u.toString(16),i=i+r.substr(r.length-2,2);return i},uTF8Encode=function(n){var i,r,t;for(n=n.replace(/\x0d\x0a/g,"\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},EV_MsgBox_ID="",originTop,originalHeight,zoomRatio,originalParametersInitialized,uploadFile,camSafeUrlEncode,tbl_body_hot,tbl_body_latest;window.onresize=function(){EV_MsgBox_ID.length>0&&(EV_Show_bgDiv(),EV_Show_msgDiv())};originalParametersInitialized=!1;window.onscroll=function(){EV_MsgBox_ID.length>0&&EV_Show_bgDiv()};uploadFile=function(n,t,i){var r=t+"/"+prevFile.indexOf(n)+".jpg";getAuthorization({Method:"PUT",Pathname:"/"+r},function(t,u){if(t){alert(t);return}var s=u.Authorization,e=u.XCosSecurityToken,o=(prefix+camSafeUrlEncode(r)).replace(/%2F/,"/"),f=new XMLHttpRequest;f.open("PUT",o,!1);f.setRequestHeader("Authorization",s);f.setRequestHeader("Cache-Control","public, max-age = 0");e&&f.setRequestHeader("x-cos-security-token",e);f.onreadystatechange=function(){if(f.status===200||f.status===206){var t=f.getResponseHeader("etag");prevFile.indexOf(n)==prevfile.length-1&&imgs_failed_upload==0&&(cansubmit=!0);i(null,{url:o,ETag:t})}else imgs_failed_upload+=1,i("文件 "+r+" 上传失败，状态码："+f.status)};f.onerror=function(){i("文件 "+r+" 上传失败，请检查是否没配置 CORS 跨域规则")};f.send(n)})};camSafeUrlEncode=function(n){return encodeURIComponent(n).replace(/!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")};tbl_body_hot=document.getElementById("hottest_stories");tbl_body_latest=document.getElementById("latest_stories");