@{
    ViewData["Title"] = "保单列表";
    Layout = "_LayoutMini";
}
@using Insurance.Models
@model Insurance.Models.HistoricalModel


<div>
    @{
        UserInfoModel currentUser = ViewBag.CurrentUser;
        if (Model.SummaryByYearTable != null)
        {
            <table class="table table-striped table-bordered">
                <thead class="thead-dark">
                    <tr style="text-align:center">
                        <th scope="col">年份</th>
                        <th scope="col">人数</th>
                        <th scope="col">总保费</th>
                        <th scope="col">总赔款</th>
                        <th scope="col">操作</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (System.Data.DataRow row in Model.SummaryByYearTable.Rows)
                    {
                        <tr style="text-align:center">
                            <td class="td_middle">@row[0]</td>
                            <td class="td_middle">@row[1]</td>
                            <td class="td_middle">@row[2]</td>
                            <td class="td_middle">@row[3]</td>
                            <td class="td_middle"><a href="/MiniAppHome/YearHistory?year=@row[0]&openId=@ViewBag.OpenId" class="btn btn-primary">详</a></td>
                        </tr>
                    }
                </tbody>
            </table>
        }
        else
        {
            if (currentUser.AllowCreateAccount == "1")
            {
                <table class="table table-striped table-bordered">
                    <thead class="thead-dark">
                        <tr style="text-align:center">
                            <th scope="col">公司</th>
                            <th scope="col">人数</th>
                            <th scope="col">累积保费</th>
                            <th scope="col">操作</th>

                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.IsHistory == null || !ViewBag.IsHistory)
                        {
                            <tr style="text-align:center">
                                <td class="td_middle" style="color:blue"><strong>合计</strong></td>
                                <td class="td_middle" style="color:blue"><strong>@Model.CompanyList.Sum(headcount => headcount.EmployeeNumber)</strong></td>
                                <td class="td_middle" style="color:blue"><strong>@Model.CompanyList.Sum(headcount => headcount.TotalCost)</strong></td>
                                <td><a class="btn btn-primary" href="/MiniAppHome/SummaryByYear?openId=@ViewBag.OpenId">年详</a></td>
                            </tr>
                        }
                        @if (Model.CompanyList != null && Model.CompanyList.Count > 0)
                        {
                            @foreach (Company item in Model.CompanyList)
                            {
                                <tr style="text-align:center">
                                    <td class="td_middle">@item.AbbrName</td>
                                    <td class="td_middle">@item.EmployeeNumber</td>
                                    <td class="td_middle">@item.TotalCost</td>
                                    @if (ViewBag.IsHistory == null || !ViewBag.IsHistory)
                                    {
                                        <td class="td_middle"><a href="/MiniAppHome/MiniCompanyHisitoryByMonth?name=@item.Name&openId=@ViewBag.OpenId" class="btn btn-primary">详</a></td>
                                    }
                                    else
                                    {
                                        <td class="td_middle"><a href="/MiniAppHome/MiniYearlyHistoryData?companyName=@item.Name&year=@item.StartDate.Year&openId=@ViewBag.OpenId" class="btn btn-primary">详</a></td>
                                    }
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            }
        }
    }
</div>